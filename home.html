<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script>
      THREEx.ArToolkitContext.baseURL =
        "https://raw.githack.com/jeromeetienne/ar.js/master/three.js/";
    </script>
    <link rel="stylesheet" href="./index.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
    />
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      cursor="rayOrigin: mouse; fuse: true; fuseTimeout: 0;"
      raycaster="objects: [gps-entity-place];"
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;"
    >
      <a-camera gps-camera rotation-reader> </a-camera>
    </a-scene>
    <button
      type="button"
      class="btn btn-primary"
      data-toggle="modal"
      data-target="#routes"
      style="    position: fixed;
    bottom: 0;
    width: 100vw;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
"
    >
      Navigation
    </button>

    <div
      id="routes"
      class="modal fade"
      tabindex="-1"
      role="dialog"
      aria-labelledby="LargeModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="myLargeModalLabel">Routes</h4>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">Ã—</span>
            </button>
          </div>
          <div class="modal-body" style="padding:0"></div>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script>
      const loadPlaces = function(coords, end) {
        // console.log(end);
        return loadPlaceFromAPIs(coords, end);
      };

      // getting places from REST APIs
      function loadPlaceFromAPIs(position, end) {
        var endpoint = `https://api.openrouteservice.org/v2/directions/foot-walking?api_key=5b3ce3597851110001cf62487ff45692bdc34cdfbc509ce51f522ec0&start=${position.longitude},${position.latitude}&end=${end.long},${end.lat}`;
        // console.log(endpoint);
        return fetch(endpoint)
          .then(res => {
            return res.json().then(resp => {
              var data = [];
              data = data.concat(resp.features["0"].geometry.coordinates);
              resp.features["0"].properties.segments["0"].steps.forEach(
                step => {
                  // step.way_points[0] //index of data
                  //   console.log(data[step.way_points[0]]);
                  data[step.way_points[0]].push(step.instruction);
                }
              );
              //   console.log(data);
              return data;
            });
          })
          .catch(err => {
            console.error("Error with places API", err);
          });
      }

      //   window.onload = () => {
      //     ;
      //   };
    </script>
    <script>
      var navbutton = [
        {
          name: "Vishwakarma Hostel",
          lat: 25.257578,
          long: 82.985853
        },
        {
          name: "Swatantrata Bhavan",
          lat: 25.260576,
          long: 82.993757
        },
        {
          name: "ADV Grounds",
          lat: 25.259153,
          long: 82.989267
        },
        {
          name: "LC",
          lat: 25.260911,
          long: 82.986833
        },
        {
          name: "CCD",
          lat: 25.258057,
          long: 82.98686
        },
        {
          name: "G1-G11",
          lat: 25.262131,
          long: 82.992954
        },
        {
          name: "LT3",
          lat: 25.260209,
          long: 82.99055
        },
        {
          name: "Technex Office",
          lat: 25.261372,
          long: 82.986774
        },
        {
          name: "Hyderabad Gate",
          lat: 82.982598,
          long: 25.262963
        },
        {
          name: "Visvesvaraya Hostel",
          lat: 25.263038,
          long: 82.983882
        },
        {
          name: "Aryabhatta Hostel",
          lat: 25.263944,
          long: 82.984399
        },
        {
          name: "ABLT",
          lat: 25.263182,
          long: 82.988691
        },
        {
          name: "Vishwanath Temple",
          lat: 25.26568,
          long: 82.989624
        },
        {
          name: "Library",
          lat: 25.261804,
          long: 82.989914
        },
        {
          name: "Girls Hostel",
          lat: 25.261037,
          long: 82.98345
        },
        {
          name: "SC Dey",
          lat: 25.260237,
          long: 82.987016
        },
        {
          name: "Guest House",
          lat: 25.26014,
          long: 82.9848
        }
      ];
      $(window).on("load", () => {
        navbutton.forEach(button => {
          $(".modal-body").append(`<button
                lat="${button.lat}"
                long="${button.long}"
                type="button"
                class="list-group-item list-group-item-action"
              >
                ${button.name}
              </button>`);
        });

        function drawpath(end) {
          const scene = document.querySelector("a-scene");
          return navigator.geolocation.getCurrentPosition(
            function(position) {
              loadPlaces(position.coords, end).then(places => {
                // console.log(places);
                places.forEach(place => {
                  console.log(place);
                  const latitude = place[1];
                  const longitude = place[0];
                  // add place icon
                  const icon = document.createElement("a-image");
                  icon.setAttribute(
                    "gps-entity-place",
                    `latitude: ${latitude}; longitude: ${longitude}`
                  );
                  let msg = "This Way";
                  if (place[2]) {
                    msg = place[2];
                  }
                  icon.setAttribute(
                    "src",
                    `data:image/svg+xml;utf8,<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	                viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                    <style type="text/css">
                        .st1{font-family:'MyriadPro-Regular';}
                        
                    </style>
                    <g>
                        <g>
                            <path d="M254.4,15.1c-70.9,0-128.6,57.7-128.6,128.6c0,21.3,5.3,42.4,15.4,61.1l106.1,192c1.4,2.6,4.1,4.1,7,4.1
                                c2.9,0,5.6-1.6,7-4.1l106.2-192c10.1-18.7,15.4-39.8,15.4-61.1C383,72.8,325.3,15.1,254.4,15.1z M254.4,208
                                c-35.5,0-64.3-28.8-64.3-64.3s28.8-64.3,64.3-64.3s64.3,28.8,64.3,64.3S289.8,208,254.4,208z"/>
                        </g>
                    </g>
                    <text  transform="matrix(1 0 0 1 164.8341 467.5875)" class="st1 st2">${msg}</text>
                    </svg>
                    `
                  );
                  //   icon.setAttribute("scale", "40, 40,40");

                  scene.appendChild(icon);
                });
              });
            },
            err => console.error("Error in retrieving position", err),
            {
              enableHighAccuracy: true,
              maximumAge: 0,
              timeout: 27000
            }
          );
        }

        $(".modal-body button").click(e => {
          $("#routes").modal("hide");
          //   console.log($(e.target).attr("lat"));
          var end = {
            lat: $(e.target).attr("lat"),
            long: $(e.target).attr("long")
          };
          drawpath(end);
        });
      });
    </script>
  </body>
</html>
